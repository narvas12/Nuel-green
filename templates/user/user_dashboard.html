{% extends 'base.html' %}

{% block content %}
  <h1>Welcome, {{ user.username }}!!</h1>
  {% if user.is_authenticated %}
    <h2>Enrolled Courses</h2>
    {% if enrolled_courses %}
      <ul>
        {% for course in enrolled_courses %}
        <div class="user_courses">
          <li><a href="{% url 'academy:course_detail' course.slug %}">{{ course.course_title }}</a></li>
          <li>
            <ul>
              {% for assessment_title, score in assessment_scores.items %}
                {% if assessment_title == course.course_title %}
                  <li>
                    {{ assessment_title }}
                    {% if score %}
                      <p>Your score: {{ score }}%</p>
                    {% else %}
                      <p>No score available</p>
                    {% endif %}
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </li>
        </div>
        {% endfor %}
      </ul>
    {% else %}
      <p>You haven't enrolled in any courses yet.</p>
    {% endif %}
  {% else %}
    <p>{{ message }}</p>
    <p><a href="{% url 'academy:signin' %}">Log in</a></p>
  {% endif %}


  {% for course_progress in progress_data %}
  <div class="course-progress">
    <h3>{{ course_progress.course.course_title }}</h3>
    <p>Total Weeks: {{ course_progress.total_weeks }}</p>
    <ul>
      {% for progress in course_progress.user_progress %}
      <li>Week {{ progress.week }}: {{ progress.status }}</li>
      {% endfor %}
    </ul>
    <h4>Assessment Scores:</h4>
    <ul>
      {% for score in course_progress.assessment_scores %}
      <li>{{ score.assessment.title }}: {{ score.score }}%</li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}



  <div class="course-progress">
    <h3>Course Progress</h3>
    {% if progress_data %}
      <ul>
        {% for data in progress_data %}
          <li>
            <h4>{{ data.course.course_title }}</h4>
            <p>Completed Lessons: {{ data.completed_lessons }} / {{ data.total_lessons }}</p>
            <p>Progress: {{ data.progress_percentage }}%</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No progress data available.</p>
    {% endif %}
  </div>

  <script>
    // ... existing JavaScript code ...
  </script>
{% endblock %}
