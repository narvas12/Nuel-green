{% extends "base.html" %}

{% block content %}
  <h2>Create Assessment</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Create Assessment</button>
  </form>
  
  <script>
    $(document).ready(function() {
      $('#id_course').on('change', function() {
        var course_id = $(this).val();
        if (course_id) {
          $.ajax({
            type: 'GET',
            url: '{% url "instructors:get_modules_and_lessons" %}',
            data: {'course_id': course_id},
            success: function(data) {
              console.log('Data received:', data); // Debug line
              var moduleDropdown = $('#id_module');
              moduleDropdown.empty();
              moduleDropdown.append('<option value="">Select a module</option>');
              $.each(data.modules, function(index, module) {
                moduleDropdown.append('<option value="' + module.id + '">' + module.module_title + '</option>');
              });
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error('Error:', textStatus, errorThrown); // Debug line
              // Handle errors here if needed
            }
          });
        } else {
          // If no course is selected, empty the module dropdown
          $('#id_module').empty();
        }
      });
    
      // Add similar code for loading lessons based on the selected module
      $('#id_module').on('change', function() {
        var module_id = $(this).val();
        if (module_id) {
          $.ajax({
            type: 'GET',
            url: '{% url "instructors:get_modules_and_lessons" %}',
            data: {'module_id': module_id},
            success: function(data) {
              console.log('Data received:', data); // Debug line
              var lessonDropdown = $('#id_lesson');
              lessonDropdown.empty();
              lessonDropdown.append('<option value="">Select a lesson</option>');
              $.each(data.lessons, function(index, lesson) {
                lessonDropdown.append('<option value="' + lesson.id + '">' + lesson.title + '</option>');
              });
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error('Error:', textStatus, errorThrown); // Debug line
              // Handle errors here if needed
            }
          });
        } else {
          // If no module is selected, empty the lesson dropdown
          $('#id_lesson').empty();
        }
      });
    });
    </script>
    
{% endblock %}
